:root {
   --uom: 1rem;
   --max-aside: 4in;
   --max-article: 6.25in;
   --safe-area-inset-top: env(safe-area-inset-top, 0px);
   --safe-area-inset-right: env(safe-area-inset-right, 0px);
   --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
   --safe-area-inset-left: env(safe-area-inset-left, 0px);
   --safe-area-inset: env(safe-area-inset, 0px);
}

body {
   border: 0;
   margin: 0;
   padding: 0;
   display: flex;
   flex-flow: row-reverse wrap;
   -webkit-text-size-adjust: 100%;
   box-sizing: initial; /* box-sizing: border-box does not work with -webkit-fill-available. It could have spared a lot of calc statements, but I tried it, doesn't work. don't bother. */
   overflow-x: hidden;
}

header,
aside,
article {
   border: 0;
   margin: 0;
   padding: var(--uom);
}

header {
   min-height: calc(100vh - calc(var(--uom) * 2));
   min-height: -webkit-fill-available;
   max-height: calc(100vh - calc(var(--uom) * 2));
   position: -webkit-sticky;
   position: sticky;
   top: 0;
   padding-left: calc(var(--uom) + var(--safe-area-inset-left));
}

article ~ header {
   /*          100vh - article width      - padding * 4 (for left and right padding of 2 elements) */
   width: calc(100vw - var(--max-article) - calc(var(--uom) * 4) - var(--safe-area-inset-left));
}

aside + header {
   width: calc(100vw - var(--max-aside) - calc(var(--uom) * 4) - var(--safe-area-inset-left));
}

article + aside + header {
   width: calc(100vw - var(--max-article) - var(--max-aside) - calc(var(--uom) * 6) - var(--safe-area-inset-left));
}

aside {
   width: 100%;
   height: 100%;
   max-width: calc(var(--max-aside) - var(--safe-area-inset-right));
   padding-right: calc(var(--uom) + var(--safe-area-inset-right));
}

article + aside {
   position: -webkit-sticky;
   position: sticky;
   top: 0;
   height: 100%;
   max-height: calc(100vh - calc(var(--uom) * 2));
   overflow: scroll;
   max-width: var(--max-aside);
   padding-right: var(--uom);
}

article {
   min-height: 100vh;
   min-height: -webkit-fill-available;
   width: 100%;
   max-width: calc(var(--max-article) - var(--safe-area-inset-right));
   padding-right: calc(var(--uom) + var(--safe-area-inset-right));
}

/* navigation bar styling */
nav {
   margin: calc(var(--uom) * -1) calc(var(--uom) * -1) 0 calc(var(--uom) * -1);
   padding: var(--uom) var(--uom) var(--uom) var(--uom);
   height: 1.5rem;
   background-color: rgba(255,255,255,.2);
   width: 100%;
   max-width: 100%;
   white-space: nowrap;
   overflow-x: auto;
   -webkit-overflow-scrolling: auto;
}

aside nav,
article nav {
   background-color: #f5f5f5;
}

@media screen and (prefers-color-scheme: dark) {
   nav {
      background-color: rgba(0,0,0,.2);
   }
   aside nav,
   article nav {
      background-color: #191919;
   }
}

nav > a {
   margin: 0;
   line-height: calc(var(--uom) * 1.5);
   display: inline-block;
   padding: 0 var(--uom);
}

nav > :first-child {
   padding-left: 0;
}

nav > :last-child {
   padding-right: calc(var(--uom) * 1);
}

header > nav {
   margin-left: calc(calc(var(--uom) * -1) - var(--safe-area-inset-left));
   padding-left: calc(var(--uom) + var(--safe-area-inset-left));
}

aside > nav {
   position: -webkit-sticky;
   position: sticky;
   top: 0;
   left: 0;
   z-index: 1;
   margin-right: calc(calc(var(--uom) * -1) - var(--safe-area-inset-right));
   padding-right: calc(var(--uom) + var(--safe-area-inset-right));
}

article + aside > nav {
   margin-right: calc(var(--uom) * -1);
   padding-right: var(--uom);
   position: fixed;
   top: var(--uom);
   left: calc(100vw - var(--max-article) - var(--max-aside) - calc(var(--uom) * 3));
   z-index: 1;
}

article > nav {
   position: -webkit-sticky;
   position: sticky;
   top: 0;
   margin-right: calc(calc(var(--uom) * -1) - var(--safe-area-inset-right));
   padding-right: calc(var(--uom) + var(--safe-area-inset-right));
}

/* the width of a tablet in landscape (and lower): hide the aside, override width of header to account for hidden aside */
@media (max-width: 1700px){
   article + aside {
      display: none;
   }

   article + aside + header {
      /*          100vh - article width      - padding * 4 (for left and right padding of 2 elements) */
      width: calc(100vw - var(--max-article) - calc(var(--uom) * 4) - var(--safe-area-inset-left));
   }
}

/* hide the header when smaller than a desktop, and center the article (~< ipad tablet max portrait width 1024) */
@media (max-width: 1022px){
   article ~ header {
      display: none;
   }

   article {
      margin: 0 auto;
      width: calc(var(--max-article) - var(--safe-area-inset-left));
      padding-left: calc(var(--uom) + var(--safe-area-inset-left));
   }

   article > nav {
      position: fixed;
      top: var(--uom);
      left: var(--uom);
      padding-left: calc(var(--uom) + var(--safe-area-inset-left));
      width: calc(100% - calc(var(--uom) * 2) - var(--safe-area-inset-left));
   }
}

/* mobile portrait gets stacked (header/aside).
   mobile landscape (on a very small screen) gets stacked too,
   to achieve this we: unset position sticky and change the flex-flow */
@media (orientation: portrait) and (max-width: 6in), (orientation: landscape) and (max-width: 6in) {
   body {
      flex-flow: row-reverse wrap-reverse;
   }

   aside + header {
      width: calc(100vw - calc(var(--uom) * 2));
      position: initial;
   }

   aside {
      max-width: calc(100vw - calc(var(--uom) * 2));
   }
   header > nav {
      width: calc(100vw - calc(var(--uom) * 2));
   }
   aside > nav {
      width: calc(100vw - calc(var(--uom) * 2));
   }
}

body::-webkit-scrollbar-track {
   box-shadow: inset 0 0 6px rgba(0,0,0,.1);
   -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.1);
   background-color: transparent;
}

body::-webkit-scrollbar {
   background-color: transparent;
}

body::-webkit-scrollbar-thumb {
   box-shadow: inset 0 0 6px rgba(0,0,0,.3);
   -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
   background-color: transparent;
}

/* Hide scrollbar for Chrome, Safari and Opera */
body::-webkit-scrollbar,
aside::-webkit-scrollbar,
article::-webkit-scrollbar {
   display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
body,
aside,
article {
   -ms-overflow-style: none;  /* IE and Edge */
   scrollbar-width: none;  /* Firefox */
}
